const t={top:"bottom",left:"right"},e={top:"height",bottom:"height",left:"width",right:"width"},i={width:{dimension:"width",opposite:"height",start:"left",end:"right"},height:{dimension:"height",opposite:"width",start:"top",end:"bottom"}};function n(t,n){const s=e[t],o=i[s],r=o.opposite,l=i[r];return{id:t,opposite:n,dimension:s,dimensionStart:o.start,dimensionEnd:o.end,altDimension:r,altStart:l.start,altEnd:l.end,main:{...o},alt:{...l}}}const s=Object.keys(t).reduce(((e,i)=>{const s=t[i];return e[i]=n(i,s),e[s]=n(s,i),e}),{}),o={start:1,center:1,end:1},r=t=>t<0?0:t,l=(t,e,i,n,o=s[i].opposite)=>n(t[i],e[i])?e[i]:n(t[i],e[o])?t[i]:e[o],d=(t,e,i)=>l(t,e,i,((t,e)=>t<e)),h=(t,e,i)=>l(t,e,i,((t,e)=>t>e));function a(t){return t.visibleHeight=r(t.bottom-t.top),t.visibleWidth=r(t.right-t.left),t.isVisible=t.visibleHeight>0&&t.visibleWidth>0,t}function c(t,e){let i=e.offsetMain||0;return t.id===t.dimensionStart?-i:i}function p(t,e,i,n){const s=t[i.id],o=e[i.dimension];return(i.id===i.dimensionStart?s-o:s)+c(i,n)}function u(t,e,i,n,s){const o=t[i.altStart],r=t[i.altEnd],l=e[i.altDimension],d=function(t,e){const i=t.offsetAlt||0;return"center"===e||0===i?0:"start"===e?i:-i}(s,n);switch(n){case"start":return o+d;case"end":return r-l+d}return(o+r)/2-l/2}function g(t,e,i,n,s){const o=i[t.alt.start],r=(i[t.alt.start]+i[t.alt.end])/2,l={start:n-o>s,center:r>s/2&&n-r>s/2,end:i[t.alt.end]>s};if(l[e])return e;if("center"===e)return l.start?"start":l.end?"end":e;if(l.center)return"center";const d="start"===e?"end":"start";return l[d]?d:e}function f(t,e,i,n){return{[(t=(t=>"string"==typeof t?s[t]:t)(t)).alt.dimension]:i[t.alt.dimension],[t.main.dimension]:t.id===t.main.start?e[t.id]-n:i[t.dimension]-e[t.id]-n}}const m={getBoundingBox(t,e){const i=t.getBoundingClientRect();if(!e)return i;const{left:n,top:s,right:o,bottom:r,width:l,height:d}=i;return{left:n,top:s,right:o,bottom:r,width:l,height:d}},getVisibleBox(t,e){if(e=e||this.getViewport(),!t||t===document.body)return e;let i=t,n=[];for(;null!=i;)n.push(i),i=i.parentNode!==document.body?i.parentNode:null;let{left:s,top:o,right:r,bottom:l}=e;const c={left:s,top:o,right:r,bottom:l};for(;n.length;){let t=n.pop();const e=this.getBoundingBox(t);c.width=e.width,c.height=e.height,s=d(e,c,"left"),o=d(e,c,"top"),r=h(e,c,"right"),l=h(e,c,"bottom"),c.left=s,c.top=o,c.right=r,c.bottom=l}return a(c)},getViewport(){let t=window.innerWidth,e=window.innerHeight;const i={left:0,top:0,right:t,bottom:e,width:t,height:e},n=window.visualViewport;return n&&(i.width=n.width,i.height=n.height),a(i)},findPosition(t,e,i,n,o,r){let l=s[i],d=n;if(!1!==o.autoPlacement){let i=this.detectAvailableSide(t,e,l,n,r,o);l=i.side,d=i.align}return{position:this.getSidePosition(t,e,l,d,o),side:l.id,align:d}},detectAvailableSide(t,e,i,n,o,r){"string"==typeof i&&(i=s[i]);let l=i,d=n;const h=c(i,r),a=[i.id,i.altEnd,i.altStart,i.opposite];for(let i of a){const r=f(i,t,o,h);if(r.width>=e.width&&r.height>=e.height){l=s[i];const o=e[l.altDimension];d=g(l,n,t,r[l.altDimension],o);break}}return{side:l,align:d}},getSidePosition:(t,e,i,n,s)=>({[i.dimensionStart]:p(t,e,i,s),[i.altStart]:u(t,e,i,n,s),[i.dimensionEnd]:void 0,[i.altEnd]:void 0})};function b(t="",e,i){const n=t.split("-");let r=n[0],l=n[1];return r&&!l&&(l="center"),r in s==!1&&(r=e),l in o==!1&&(l=i),{side:r,align:l}}function E(t,e){Object.assign(t.style,e)}const w={top:0,left:0,right:"unset",bottom:"unset"};class v{constructor(t){this.scrollListeners=[],this.setOptions(t),t&&(this.refEl=t.referenceEl)}setOptions(t){this.options=S(t,{defaultSide:"bottom",defaultAlign:"start"})}setReferenceElement(t,e){this._removeScrollListeners(),this._setScrollListeners(t,e),this.refEl=t}_removeScrollListeners(){this.scrollListeners.forEach((({event:t,callback:e,el:i})=>{i.removeEventListener(t,e)})),this.scrollListeners.length=0}_setScrollListeners(t,e){let i=t.parentNode;const n=()=>this.update(e),s="scroll";for(;null!=i;)i.addEventListener(s,n),this.scrollListeners.push({el:i,event:s,callback:n}),i=i.parentNode}setPopoverElement(t){this.el=t,this.elBoundingBox=m.getBoundingBox(t)}_attachPopoverElement(t){null==t.parentNode&&document.body.appendChild(t)}_detachPopoverElement(t){t&&t.parentNode&&t.parentNode.removeChild(t)}show(t={}){this._isShowing&&this.hide(),this._isShowing=!0;let{referenceEl:e,popoverEl:i}=t;i=i||this.el,this._attachPopoverElement(i),this.setPopoverElement(i),t=Object.assign({},this.options,S(t,{defaultSide:this.options.side,defaultAlign:this.options.align})),e=e||this.refEl,this.setReferenceElement(e,t),this.update(t)}hide(){this._detachPopoverElement(this.el),this._removeScrollListeners(),this._isShowing=!1}update(t){const e=m.getViewport(),i=m.getVisibleBox(this.refEl,e);let n={display:"none"};if(i.isVisible){t=this.getUpdateOptions(Object.assign({referenceVisibleBox:i,viewport:e},this.options,t)),n.display=t.useElementDisplay||"block";const{position:s,side:o,align:r}=this.findElementPosition(t),l=function(t){return Object.keys(t).reduce(((e,i)=>{let n=t[i];return null==n?n="unset":n+="px",e[i]=n,e}),{})}(s);Object.assign(n,l),this.updateElementSideInfo(o,r)}n=this.getUpdateElementStyles(n),E(this.el,n)}getUpdateOptions(t){return t}getUpdateElementStyles(t){return t}updateElementSideInfo(t,e){this.el.setAttribute("data-side",t),this.el.setAttribute("data-align",e)}findElementPosition(t={}){let e=y("side",t,this.options),i=y("align",t,this.options),n=t.viewport||m.getViewport(),s=t.referenceVisibleBox||m.getVisibleBox(this.refEl,n);E(this.el,w);let o=this.elBoundingBox;return m.findPosition(s,o,e,i,t,n)}destroy(){this._isDestroying||this._isDestroyed||(this._isDestroying=!0,this.hide(),delete this.el,delete this.refEl,this._isDestroyed=!0)}isDestroyed(){return!0===this._isDestroyed}}function S(t,{normalizePlacement:e=!0,defaultSide:i,defaultAlign:n,leaveElements:s}={}){if(null==t||"string"==typeof t)return e?b(t,i,n):{};if(!(t=Object.assign({},t)).side&&!t.align&&e){const e=b(t.placement,i,n);t.side=e.side,t.align=e.align,delete t.placement}return s||(delete t.referenceEl,delete t.popoverEl),t}function y(t,e,i){return t in e?e[t]:i[t]}export{v as Popover,m as positioningApi};
