var StickyPopover=function(t){"use strict";const e={top:"bottom",left:"right"},i={top:"height",bottom:"height",left:"width",right:"width"},o={width:{dimension:"width",opposite:"height",start:"left",end:"right"},height:{dimension:"height",opposite:"width",start:"top",end:"bottom"}};function n(t,e){const n=i[t],s=o[n],r=s.opposite,l=o[r];return{id:t,opposite:e,dimension:n,dimensionStart:s.start,dimensionEnd:s.end,altDimension:r,altStart:l.start,altEnd:l.end,main:{...s},alt:{...l}}}const s=Object.keys(e).reduce(((t,i)=>{const o=e[i];return t[i]=n(i,o),t[o]=n(o,i),t}),{}),r={start:1,center:1,end:1},l=t=>t<0?0:t,h=(t,e,i,o,n=s[i].opposite)=>o(t[i],e[i])?e[i]:o(t[i],e[n])?t[i]:e[n],d=(t,e,i)=>h(t,e,i,((t,e)=>t<e)),a=(t,e,i)=>h(t,e,i,((t,e)=>t>e));function c(t){return t.visibleHeight=l(t.bottom-t.top),t.visibleWidth=l(t.right-t.left),t.isVisible=t.visibleHeight>0&&t.visibleWidth>0,t}function p(t,e){let i=e.offsetMain||0;return t.id===t.dimensionStart?-i:i}function u(t,e,i,o){const n=t[i.id],s=e[i.dimension];return(i.id===i.dimensionStart?n-s:n)+p(i,o)}function g(t,e,i,o,n){const s=t[i.altStart],r=t[i.altEnd],l=e[i.altDimension],h=function(t,e){const i=t.offsetAlt||0;return"center"===e||0===i?0:"start"===e?i:-i}(n,o);switch(o){case"start":return s+h;case"end":return r-l+h}return(s+r)/2-l/2}function m(t,e,i,o,n){const s=i[t.alt.start],r=(i[t.alt.start]+i[t.alt.end])/2,l={start:o-s>n,center:r>n/2&&o-r>n/2,end:i[t.alt.end]>n};if(l[e])return e;if("center"===e)return l.start?"start":l.end?"end":e;if(l.center)return"center";const h="start"===e?"end":"start";return l[h]?h:e}function v(t,e,i,o){return{[(t=(t=>"string"==typeof t?s[t]:t)(t)).alt.dimension]:i[t.alt.dimension],[t.main.dimension]:t.id===t.main.start?e[t.id]-o:i[t.dimension]-e[t.id]-o}}const f={getBoundingBox(t,e){const i=t.getBoundingClientRect();if(!e)return i;const{left:o,top:n,right:s,bottom:r,width:l,height:h}=i;return{left:o,top:n,right:s,bottom:r,width:l,height:h}},getVisibleBox(t,e){if(e=e||this.getViewport(),!t||t===document.body)return e;let i=t,o=[];for(;null!=i;)o.push(i),i=i.parentNode!==document.body?i.parentNode:null;let{left:n,top:s,right:r,bottom:l}=e;const h={left:n,top:s,right:r,bottom:l};for(;o.length;){let t=o.pop();const e=this.getBoundingBox(t);h.width=e.width,h.height=e.height,n=d(e,h,"left"),s=d(e,h,"top"),r=a(e,h,"right"),l=a(e,h,"bottom"),h.left=n,h.top=s,h.right=r,h.bottom=l}return c(h)},getViewport(){let t=window.innerWidth,e=window.innerHeight;const i={left:0,top:0,right:t,bottom:e,width:t,height:e},o=window.visualViewport;return o&&(i.width=o.width,i.height=o.height),c(i)},findPosition(t,e,i,o,n,r){let l=s[i],h=o;if(!1!==n.autoPlacement){let i=this.detectAvailableSide(t,e,l,o,r,n);l=i.side,h=i.align}return{position:this.getSidePosition(t,e,l,h,n),side:l.id,align:h}},detectAvailableSide(t,e,i,o,n,r){"string"==typeof i&&(i=s[i]);let l=i,h=o;const d=p(i,r),a=[i.id,i.altEnd,i.altStart,i.opposite];for(let i of a){const r=v(i,t,n,d);if(r.width>=e.width&&r.height>=e.height){l=s[i];const n=e[l.altDimension];h=m(l,o,t,r[l.altDimension],n);break}}return{side:l,align:h}},getSidePosition:(t,e,i,o,n)=>({[i.dimensionStart]:u(t,e,i,n),[i.altStart]:g(t,e,i,o,n),[i.dimensionEnd]:void 0,[i.altEnd]:void 0})};function w(t="",e,i){const o=t.split("-");let n=o[0],l=o[1];return n&&!l&&(l="center"),n in s==!1&&(n=e),l in r==!1&&(l=i),{side:n,align:l}}function b(t,e){Object.assign(t.style,e)}const S={top:0,left:0,right:"unset",bottom:"unset"};class E{constructor(t){this.scrollListeners=[],this.setOptions(t),t&&(this.refEl=t.referenceEl)}setOptions(t){this.options=y(t,{defaultSide:"bottom",defaultAlign:"start"})}setReferenceElement(t,e){this._removeScrollListeners(),this._setScrollListeners(t,e),this.refEl=t}_removeScrollListeners(){this.scrollListeners.forEach((({event:t,callback:e,el:i})=>{i.removeEventListener(t,e)})),this.scrollListeners.length=0}_setScrollListeners(t,e){let i=t.parentNode;const o=()=>this.update(e),n="scroll";for(;null!=i;)i.addEventListener(n,o),this.scrollListeners.push({el:i,event:n,callback:o}),i=i.parentNode}setPopoverElement(t){this.el=t,this.elBoundingBox=f.getBoundingBox(t)}_attachPopoverElement(t){null==t.parentNode&&document.body.appendChild(t)}_detachPopoverElement(t){t&&t.parentNode&&t.parentNode.removeChild(t)}show(t={}){this._isShowing&&this.hide(),this._isShowing=!0;let{referenceEl:e,popoverEl:i}=t;i=i||this.el,this._attachPopoverElement(i),this.setPopoverElement(i),t=Object.assign({},this.options,y(t,{defaultSide:this.options.side,defaultAlign:this.options.align})),e=e||this.refEl,this.setReferenceElement(e,t),this.update(t)}hide(){this._detachPopoverElement(this.el),this._removeScrollListeners(),this._isShowing=!1}update(t){const e=f.getViewport(),i=f.getVisibleBox(this.refEl,e);let o={display:"none"};if(i.isVisible){t=this.getUpdateOptions(Object.assign({referenceVisibleBox:i,viewport:e},this.options,t)),o.display=t.useElementDisplay||"block";const{position:n,side:s,align:r}=this.findElementPosition(t),l=function(t){return Object.keys(t).reduce(((e,i)=>{let o=t[i];return null==o?o="unset":o+="px",e[i]=o,e}),{})}(n);Object.assign(o,l),this.updateElementSideInfo(s,r)}o=this.getUpdateElementStyles(o),b(this.el,o)}getUpdateOptions(t){return t}getUpdateElementStyles(t){return t}updateElementSideInfo(t,e){this.el.setAttribute("data-side",t),this.el.setAttribute("data-align",e)}findElementPosition(t={}){let e=P("side",t,this.options),i=P("align",t,this.options),o=t.viewport||f.getViewport(),n=t.referenceVisibleBox||f.getVisibleBox(this.refEl,o);b(this.el,S);let s=this.elBoundingBox;return f.findPosition(n,s,e,i,t,o)}destroy(){this._isDestroying||this._isDestroyed||(this._isDestroying=!0,this.hide(),delete this.el,delete this.refEl,this._isDestroyed=!0)}isDestroyed(){return!0===this._isDestroyed}}function y(t,{normalizePlacement:e=!0,defaultSide:i,defaultAlign:o,leaveElements:n}={}){if(null==t||"string"==typeof t)return e?w(t,i,o):{};if(!(t=Object.assign({},t)).side&&!t.align&&e){const e=w(t.placement,i,o);t.side=e.side,t.align=e.align,delete t.placement}return n||(delete t.referenceEl,delete t.popoverEl),t}function P(t,e,i){return t in e?e[t]:i[t]}function _(t="not implemented",e){const i=new Error(t);throw console.warn(e),i}const x={items:new Map,getKey:t=>t.singleton||"default",get(t){const e=this.getKey(t);return this.items.get(e)},remove(t){const e=this.getKey(t);this.items.delete(e)},create(t,e){const i=this.getKey(t),o={key:i,popoverContext:t,remove:e};this.items.set(i,o)}};class B{initializePopover(t){this.setupPopoverShow(t,(e=>this._open(t,e)))}setupPopoverShow(t,e){_("setupPopoverShowTrigger not implemented","setupPopoverShow should implement settling event listeners to schedule popover show\n\t\tsetupPopoverShow(options, callback) {\n\t\t\t// information about reference element should be provided by you in config\n\t\t\toptions.referenceEl.addEventListener('mouseenter', callback);\n\t\t}")}getPopoverContext(t){_("getPopoverContext not implemented","getPopoverContext should return your popoverContext\n\t\tgetPopoverContext(options) {\n\t\t\t// popoverContext should have show method.\n\n\t\t\treturn {\n\t\t\t\tshow() {\n\t\t\t\t\t// ...\n\t\t\t\t},\n\t\t\t\tremove() {\n\t\t\t\t\t// ...\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\t")}_open(t,e){const i=this.getPopoverContext(t);this.cancelRemoving(i),!0!==i.showing?i.showTimer||this.scheduleShow(i,t):!0===i.toggleStrategy&&this._removePopover(i)}_ensureSingleton(t){x.create(t,(()=>{x.remove(t),this._removePopover(t),this._tryRemoveShowedSingleton(t,!1)}))}_tryRemoveShowedSingleton(t,e){const i=x.get(t);if(!i)return;const o=i.popoverContext;o&&o.showing&&t===o===e&&i.remove()}_removePopover(t){this.cancelRemoving(t),this.cancelShowing(t),t.remove(),t.showing=!1}scheduleRemove(t){let e=t.removeDelay;null==e&&(e=500),this.cancelShowing(t),t.showing&&(this.cancelRemoving(t),t.removeTimeout=setTimeout((()=>this._removePopover(t)),e))}scheduleShow(t,e){let i=t.showDelay;null==i&&(i=500),t.showTimeout=setTimeout((()=>{this._tryRemoveShowedSingleton(t,!1),this._ensureSingleton(t),t.show(e),t.showing=!0}),i)}cancelRemoving(t){t.removeTimeout&&(clearTimeout(t.removeTimeout),delete t.removeTimeout)}cancelShowing(t){t.showTimeout&&(clearTimeout(t.showTimeout),delete t.showTimeout)}}return t.AbstractPopoverApi=B,t.Popover=E,t.PopoverApi=class extends B{constructor(){super(),this._popoverInstances=new Map}getPopoverInstance(t){const e=t.singleton||"default";let i=this._popoverInstances.get(e);return i||(i=new E,this._popoverInstances.set(e,i)),i}createPopoverContext(t,e,i={}){const o=this.getPopoverInstance(t);return{show(){const t=e(this);o.show(t)},remove(){o.hide()},...i}}},t.positioningApi=f,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
