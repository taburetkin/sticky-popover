!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["sticky-popover"]={})}(this,(function(t){"use strict";const e={top:"bottom",left:"right"},o={top:"height",bottom:"height",left:"width",right:"width"},i={width:{dimension:"width",opposite:"height",start:"left",end:"right"},height:{dimension:"height",opposite:"width",start:"top",end:"bottom"}};function n(t,e){const n=o[t],s=i[n],r=s.opposite,l=i[r];return{id:t,opposite:e,dimension:n,dimensionStart:s.start,dimensionEnd:s.end,altDimension:r,altStart:l.start,altEnd:l.end,main:{...s},alt:{...l}}}const s=Object.keys(e).reduce(((t,o)=>{const i=e[o];return t[o]=n(o,i),t[i]=n(i,o),t}),{}),r={start:1,center:1,end:1},l=t=>t<0?0:t,h=(t,e,o,i,n=s[o].opposite)=>i(t[o],e[o])?e[o]:i(t[o],e[n])?t[o]:e[n],d=(t,e,o)=>h(t,e,o,((t,e)=>t<e)),a=(t,e,o)=>h(t,e,o,((t,e)=>t>e));function c(t){return t.visibleHeight=l(t.bottom-t.top),t.visibleWidth=l(t.right-t.left),t.isVisible=t.visibleHeight>0&&t.visibleWidth>0,t}function p(t,e){let o=e.offsetMain||0;return t.id===t.dimensionStart?-o:o}function u(t,e,o,i){const n=t[o.id],s=e[o.dimension];return(o.id===o.dimensionStart?n-s:n)+p(o,i)}function g(t,e,o,i,n){const s=t[o.altStart],r=t[o.altEnd],l=e[o.altDimension],h=function(t,e){const o=t.offsetAlt||0;return"center"===e||0===o?0:"start"===e?o:-o}(n,i);switch(i){case"start":return s+h;case"end":return r-l+h}return(s+r)/2-l/2}function m(t,e,o,i,n){const s=o[t.alt.start],r=(o[t.alt.start]+o[t.alt.end])/2,l={start:i-s>n,center:r>n/2&&i-r>n/2,end:o[t.alt.end]>n};if(l[e])return e;if("center"===e)return l.start?"start":l.end?"end":e;if(l.center)return"center";const h="start"===e?"end":"start";return l[h]?h:e}function f(t,e,o,i){return{[(t=(t=>"string"==typeof t?s[t]:t)(t)).alt.dimension]:o[t.alt.dimension],[t.main.dimension]:t.id===t.main.start?e[t.id]-i:o[t.dimension]-e[t.id]-i}}const v={getBoundingBox(t,e){const o=t.getBoundingClientRect();if(!e)return o;const{left:i,top:n,right:s,bottom:r,width:l,height:h}=o;return{left:i,top:n,right:s,bottom:r,width:l,height:h}},getVisibleBox(t,e){if(e=e||this.getViewport(),!t||t===document.body)return e;let o=t,i=[];for(;null!=o;)i.push(o),o=o.parentNode!==document.body?o.parentNode:null;let{left:n,top:s,right:r,bottom:l}=e;const h={left:n,top:s,right:r,bottom:l};for(;i.length;){let t=i.pop();const e=this.getBoundingBox(t);h.width=e.width,h.height=e.height,n=d(e,h,"left"),s=d(e,h,"top"),r=a(e,h,"right"),l=a(e,h,"bottom"),h.left=n,h.top=s,h.right=r,h.bottom=l}return c(h)},getViewport(){let t=window.innerWidth,e=window.innerHeight;const o={left:0,top:0,right:t,bottom:e,width:t,height:e},i=window.visualViewport;return i&&(o.width=i.width,o.height=i.height),c(o)},findPosition(t,e,o,i,n,r){let l=s[o],h=i;if(!1!==n.autoPlacement){let o=this.detectAvailableSide(t,e,l,i,r,n);l=o.side,h=o.align}return{position:this.getSidePosition(t,e,l,h,n),side:l.id,align:h}},detectAvailableSide(t,e,o,i,n,r){"string"==typeof o&&(o=s[o]);let l=o,h=i;const d=p(o,r),a=[o.id,o.altEnd,o.altStart,o.opposite];for(let o of a){const r=f(o,t,n,d);if(r.width>=e.width&&r.height>=e.height){l=s[o];const n=e[l.altDimension];h=m(l,i,t,r[l.altDimension],n);break}}return{side:l,align:h}},getSidePosition:(t,e,o,i,n)=>({[o.dimensionStart]:u(t,e,o,n),[o.altStart]:g(t,e,o,i,n),[o.dimensionEnd]:void 0,[o.altEnd]:void 0})};function w(t="",e,o){const i=t.split("-");let n=i[0],l=i[1];return n&&!l&&(l="center"),n in s==!1&&(n=e),l in r==!1&&(l=o),{side:n,align:l}}function b(t,e){Object.assign(t.style,e)}const S={top:0,left:0,right:"unset",bottom:"unset"};class y{constructor(t){this.scrollListeners=[],this.setOptions(t),t&&(this.refEl=t.referenceEl)}setOptions(t){this.options=E(t,{defaultSide:"bottom",defaultAlign:"start"})}setReferenceElement(t,e){this._removeScrollListeners(),this._setScrollListeners(t,e),this.refEl=t}_removeScrollListeners(){this.scrollListeners.forEach((({event:t,callback:e,el:o})=>{o.removeEventListener(t,e)})),this.scrollListeners.length=0}_setScrollListeners(t,e){let o=t.parentNode;const i=()=>this.update(e),n="scroll";for(;null!=o;)o.addEventListener(n,i),this.scrollListeners.push({el:o,event:n,callback:i}),o=o.parentNode}setPopoverElement(t){this.el=t,this.elBoundingBox=v.getBoundingBox(t)}_attachPopoverElement(t){null==t.parentNode&&document.body.appendChild(t)}_detachPopoverElement(t){t&&t.parentNode&&t.parentNode.removeChild(t)}show(t={}){this._isShowing&&this.hide(),this._isShowing=!0;let{referenceEl:e,popoverEl:o}=t;o=o||this.el,this._attachPopoverElement(o),this.setPopoverElement(o),t=Object.assign({},this.options,E(t,{defaultSide:this.options.side,defaultAlign:this.options.align})),e=e||this.refEl,this.setReferenceElement(e,t),this.update(t)}hide(){this._detachPopoverElement(this.el),this._removeScrollListeners(),this._isShowing=!1}update(t){const e=v.getViewport(),o=v.getVisibleBox(this.refEl,e);let i={display:"none"};if(o.isVisible){t=this.getUpdateOptions(Object.assign({referenceVisibleBox:o,viewport:e},this.options,t)),i.display=t.useElementDisplay||"block";const{position:n,side:s,align:r}=this.findElementPosition(t),l=function(t){return Object.keys(t).reduce(((e,o)=>{let i=t[o];return null==i?i="unset":i+="px",e[o]=i,e}),{})}(n);Object.assign(i,l),this.updateElementSideInfo(s,r)}i=this.getUpdateElementStyles(i),b(this.el,i)}getUpdateOptions(t){return t}getUpdateElementStyles(t){return t}updateElementSideInfo(t,e){this.el.setAttribute("data-side",t),this.el.setAttribute("data-align",e)}findElementPosition(t={}){let e=P("side",t,this.options),o=P("align",t,this.options),i=t.viewport||v.getViewport(),n=t.referenceVisibleBox||v.getVisibleBox(this.refEl,i);b(this.el,S);let s=this.elBoundingBox;return v.findPosition(n,s,e,o,t,i)}destroy(){this._isDestroying||this._isDestroyed||(this._isDestroying=!0,this.hide(),delete this.el,delete this.refEl,this._isDestroyed=!0)}isDestroyed(){return!0===this._isDestroyed}}function E(t,{normalizePlacement:e=!0,defaultSide:o,defaultAlign:i,leaveElements:n}={}){if(null==t||"string"==typeof t)return e?w(t,o,i):{};if(!(t=Object.assign({},t)).side&&!t.align&&e){const e=w(t.placement,o,i);t.side=e.side,t.align=e.align,delete t.placement}return n||(delete t.referenceEl,delete t.popoverEl),t}function P(t,e,o){return t in e?e[t]:o[t]}function _(t="not implemented",e){const o=new Error(t);throw console.warn(e),o}const x={items:new Map,getKey:t=>t.singleton||"default",get(t){const e=this.getKey(t);return this.items.get(e)},remove(t){const e=this.getKey(t);this.items.delete(e)},create(t,e){const o=this.getKey(t),i={key:o,popoverContext:t,remove:e};this.items.set(o,i)}};class B{initializePopover(t){this.setupPopoverShow(t,(e=>this._open(t,e)))}setupPopoverShow(t,e){_("setupPopoverShowTrigger not implemented","setupPopoverShow should implement settling event listeners to schedule popover show\n\t\tsetupPopoverShow(options, callback) {\n\t\t\t// information about reference element should be provided by you in config\n\t\t\toptions.referenceEl.addEventListener('mouseenter', callback);\n\t\t}")}getPopoverContext(t){_("getPopoverContext not implemented","getPopoverContext should return your popoverContext\n\t\tgetPopoverContext(options) {\n\t\t\t// popoverContext should have show method.\n\n\t\t\treturn {\n\t\t\t\tshow() {\n\t\t\t\t\t// ...\n\t\t\t\t},\n\t\t\t\tremove() {\n\t\t\t\t\t// ...\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\t")}_open(t,e){const o=this.getPopoverContext(t);this.cancelRemoving(o),!0!==o.showing?o.showTimer||this.scheduleShow(o,t):!0===o.toggleStrategy&&this._removePopover(o)}_ensureSingleton(t){x.create(t,(()=>{x.remove(t),this._removePopover(t),this._tryRemoveShowedSingleton(t,!1)}))}_tryRemoveShowedSingleton(t,e){const o=x.get(t);if(!o)return;const i=o.popoverContext;i&&i.showing&&t===i===e&&o.remove()}_removePopover(t){this.cancelRemoving(t),this.cancelShowing(t),t.remove(),t.showing=!1}scheduleRemove(t){let e=t.removeDelay;null==e&&(e=500),this.cancelShowing(t),t.showing&&(this.cancelRemoving(t),t.removeTimeout=setTimeout((()=>this._removePopover(t)),e))}scheduleShow(t,e){let o=t.showDelay;null==o&&(o=500),t.showTimeout=setTimeout((()=>{this._tryRemoveShowedSingleton(t,!1),this._ensureSingleton(t),t.show(e),t.showing=!0}),o)}cancelRemoving(t){t.removeTimeout&&(clearTimeout(t.removeTimeout),delete t.removeTimeout)}cancelShowing(t){t.showTimeout&&(clearTimeout(t.showTimeout),delete t.showTimeout)}}t.AbstractPopoverApi=B,t.Popover=y,t.PopoverApi=class extends B{constructor(){super(),this._popoverInstances=new Map}getPopoverInstance(t){const e=t.singleton||"default";let o=this._popoverInstances.get(e);return o||(o=new y,this._popoverInstances.set(e,o)),o}createPopoverContext(t,e,o={}){const i=this.getPopoverInstance(t);return{show(){const t=e(this);i.show(t)},remove(){i.hide()},...o}}},t.positioningApi=v,Object.defineProperty(t,"__esModule",{value:!0})}));
